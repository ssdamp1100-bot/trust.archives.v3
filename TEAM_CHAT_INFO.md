# دردشة الفريق - التخزين المحلي

## التغيير الرئيسي
تم فصل **دردشة الفريق (Team Chat)** عن قاعدة البيانات Supabase وأصبحت تعتمد على **localStorage** للتخزين المحلي في المتصفح.

## الفوائد
1. **عدم الحاجة لقاعدة بيانات**: لا تحتاج دردشة الفريق لجداول أو سياسات RLS في Supabase
2. **سرعة الأداء**: الرسائل تُحفظ وتُقرأ من المتصفح مباشرة بدون طلبات شبكة
3. **بساطة الصيانة**: لا داعي لإدارة جدول `messages` في قاعدة البيانات
4. **المزامنة بين التبويبات**: إذا فتحت أكثر من تبويب للموقع، ستُزامن الرسائل تلقائياً عبر storage events

## كيف يعمل
- عند إرسال رسالة، تُحفظ في `localStorage` تحت مفتاح `team_chat_messages`
- الرسائل مصفوفة JSON تحتوي على:
  - `id`: معرّف فريد
  - `content`: محتوى الرسالة
  - `user_id`: معرّف المستخدم المُرسِل
  - `created_at`: وقت الإرسال
  - `users`: معلومات المستخدم (username, full_name)
- عند فتح الدردشة، تُحمّل الرسائل من localStorage
- عند إرسال رسالة من تبويب آخر، يتلقى التبويب الحالي إشعاراً عبر `storage` event

## ملاحظات مهمة
- **الرسائل محلية لكل متصفح/جهاز**: الرسائل لا تنتقل بين أجهزة المستخدمين. كل مستخدم يرى فقط رسائله المحلية
- **الدردشة الخاصة (Direct Messages)** لا تزال تستخدم Supabase وتعمل بشكل طبيعي عبر `direct-chat-service.js`
- **مسح الرسائل**: يمكن للمسؤول (admin) استدعاء `window.chatService.clearAllMessages()` من Console لحذف جميع رسائل الفريق

## البديل إن أردت دردشة مشتركة بين الأجهزة
إذا أردت لاحقاً أن تكون دردشة الفريق مشتركة بين جميع المستخدمين على جميع الأجهزة:
1. أعد جدول `messages` في Supabase مع سياسات RLS مناسبة
2. استخدم الكود القديم من نسخة سابقة (قبل هذا التغيير) أو راجع `direct-chat-service.js` كمثال
3. أو استخدم خدمة realtime خارجية مثل Firebase أو Pusher

## الملفات المعدّلة
- `js/chat-service.js`: تم تحويله ليعتمد localStorage بدلاً من Supabase
- `js/chat.js`: تم تحديث وظائف التهيئة والاشتراك لاستخدام localStorage events بدلاً من Supabase realtime
